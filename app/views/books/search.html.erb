<div class="container mx-auto px-4 py-8">
  <div class="max-w-4xl mx-auto">
    <!-- パンくずナビ -->
    <nav class="flex mb-8" aria-label="Breadcrumb">
      <ol class="inline-flex items-center space-x-1 md:space-x-3">
        <li class="inline-flex items-center">
          <%= link_to books_path, class: "inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600" do %>
            書籍リスト
          <% end %>
        </li>
        <li>
          <div class="flex items-center">
            <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
            </svg>
            <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2">新しい本を追加</span>
          </div>
        </li>
      </ol>
    </nav>

    <!-- ページタイトル -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-4">新しい本を追加</h1>
      <p class="text-gray-600">本のタイトルを検索して、YLと語数情報を自動取得します</p>
    </div>

    <!-- 検索フォーム -->
    <div class="bg-white rounded-lg shadow-lg p-8 mb-8">
      <%= form_with url: search_books_path, method: :get, local: true, class: "space-y-6" do |form| %>
        <div>
          <label for="query" class="block text-sm font-medium text-gray-700 mb-2">
            本のタイトルを入力してください
          </label>
          <div class="flex">
            <%= form.text_field :query, 
                value: @search_query,
                placeholder: "例: Harry Potter and the Philosopher's Stone",
                class: "flex-1 rounded-l-md border-gray-300 focus:border-blue-500 focus:ring-blue-500 px-4 py-3" %>
            <%= form.submit "検索", 
                class: "bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-r-md font-medium cursor-pointer border-0" %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- 検索結果 -->
    <% if @search_query.present? %>
      <div class="bg-white rounded-lg shadow-lg p-8">
        <h2 class="text-xl font-semibold text-gray-900 mb-6">
          「<%= @search_query %>」の検索結果
        </h2>

        <% if @search_results.any? %>
          <div class="space-y-4">
            <% @search_results.each_with_index do |result, index| %>
              <div class="border border-gray-200 rounded-lg p-6">
                <div class="flex justify-between items-start mb-4">
                  <div class="flex-1">
                    <h3 class="text-lg font-medium text-gray-900 mb-2"><%= result[:title] %></h3>
                    <p class="text-gray-600 mb-2">著者: <%= result[:author] %></p>
                    
                    <div class="flex flex-wrap gap-2 mb-3">
                      <% if result[:yl].present? %>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                          YL <%= result[:yl] %>
                        </span>
                      <% else %>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-500">
                          YL 不明
                        </span>
                      <% end %>
                      
                      <% if result[:word_count].present? %>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                          <%= result[:word_count] %>語
                        </span>
                      <% else %>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-500">
                          語数 不明
                        </span>
                      <% end %>
                      
                      <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800">
                        信頼度: <%= result[:confidence] %>
                      </span>
                      <% if result[:source] %>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-800">
                          出典: <%= result[:source] %>
                        </span>
                      <% end %>
                    </div>
                  </div>
                </div>

                <div class="flex space-x-3">
                  <%= link_to new_book_path(
                      query: @search_query,
                      book_data: {
                        title: result[:title],
                        author: result[:author],
                        yl: result[:yl],
                        word_count: result[:word_count]
                      }
                    ), 
                    class: "bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium" do %>
                    この情報で登録
                  <% end %>
                  
                  <%= link_to new_book_path(
                      query: @search_query,
                      book_data: {
                        title: result[:title],
                        author: result[:author],
                        yl: "",
                        word_count: ""
                      }
                    ), 
                    class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium" do %>
                    情報を編集して登録
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="text-center py-8">
            <svg class="w-12 h-12 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <h3 class="text-lg font-medium text-gray-900 mb-2">検索結果が見つかりませんでした</h3>
            <p class="text-gray-500 mb-4">別のタイトルで検索するか、手動で登録してください</p>
            <%= link_to new_book_path(query: @search_query), 
                class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium" do %>
              手動で登録
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- ナビゲーション -->
    <div class="mt-8 text-center">
      <%= link_to books_path, class: "bg-gray-300 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-400" do %>
        書籍一覧に戻る
      <% end %>
    </div>
  </div>
</div>